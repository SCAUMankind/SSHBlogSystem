<!DOCTYPE html>
<html>
<head>
	<title>基于SSH的个人博客系统</title>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/main.css">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="css/simple-line-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="css/manager.css">
    <link rel="stylesheet" href="css/personal-message.css">
     <link rel="stylesheet" href="css/jquery-confirm.min.css">
    <link href="css/multiple-select.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="css/xcConfirm.css"/>
</head>

<body id="body">
	<header class="app-header navbar" id="header">
        <a class="navbar-brand" href="#"></a>
        <ul class="nav navbar-nav hidden-md-down">
            <li class="nav-item">
                <a class="nav-link navbar-toggler sidebar-toggler" href="#">☰</a>
            </li>

            <li class="nav-item px-1">
                <a class="nav-link" href="main.html">首页</a>
            </li>
            <li class="nav-item px-1">
                <a class="nav-link" href="blog.html">博客管理</a>
            </li>
            <li class="nav-item px-1">
                <a class="nav-link" href="#" name="randomGo">随便逛逛</a>
            </li>
        </ul>
        <ul class="nav navbar-nav ml-auto">
            <li class="nav-item dropdown">
                <a class="nav-link nav-link"  href="manager.html" role="button" aria-haspopup="true" aria-expanded="false">
                    <img name="head-image" src="" class="img-avatar" alt="admin@bootstrapmaster.com">
                    <span >admin</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link navbar-toggler aside-menu-toggler" href="index.html">退出</a>
            </li>

        </ul>
    </header>
	
    <div class="container" id="content-wrap">
		<div class="row clearfix" id="content">
			<div class="col-md-3 column "  id="content-left">
				<div class="panel-group" id="panel-800988">
					<div class="panel panel-default">
						<div class="panel-heading">
							 <a class="panel-title" data-toggle="collapse" data-parent="#panel-800988" href="#panel-element-1">个人信息</a>
						</div>
						<div id="panel-element-1" class="panel-collapse collapse">
							<div class="panel-body">
								<ul>
								 	<li><a href="#" class="1">个人信息</a></li>
								 	<li><a href="#" class="2">我的关注</a></li>
								 	<li><a href="#" class="3">我的粉丝</a></li>
								</ul>
							</div>
						</div>
					</div>
					<div class="panel panel-default">
						<div class="panel-heading">
							 <a class="panel-title" data-toggle="collapse" data-parent="#panel-800988" href="#panel-element-2">博客管理</a>
						</div>
						<div id="panel-element-2" class="panel-collapse collapse">
							<div class="panel-body">
								<ul>
								 	<li><a href="#" class="1">发表文章</a></li>
								 	<li><a href="#" class="2">博客编辑</a></li>
								 	<li><a href="#" class="3">博客分类</a></li>
								</ul>
							</div>
						</div>
					</div>
					<div class="panel panel-default">
						<div class="panel-heading">
							 <a class="panel-title" data-toggle="collapse" data-parent="#panel-800988" href="#panel-element-3">标签管理</a>
						</div>
						<div id="panel-element-3" class="panel-collapse collapse in">
							<div class="panel-body">
								<ul>
									<li >
										 <a href="#" class="1" name="create-label">新的标签</a>
									</li>
									<li>
										 <a href="#" class="2" name="modify-label">标签编辑</a>
									</li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-md-9 column " id="content-right">
				<div class="tabbable" id="tabs-948784">
					<ul class="nav nav-tabs">
						<li class="active">
							 <a href="#panel-1" data-toggle="tab" name="create-label">新的标签</a>
						</li>
						<li >
							 <a href="#panel-2" data-toggle="tab" name="modify-label">标签编辑</a>
						</li>
					</ul>
					<div class="tab-content">
						<div class="tab-pane active" id="panel-1">
							<div id="new_label">
								<div class="title">
									<h3 class="text-center">新的标签</h3>
								</div>
								<form id="create-label-form" action="#" class="form-horizontal" onsubmit="return false;">
									<div class="row form-group">
										<label for="name" class="control-label col-md-2
										col-md-push-2">标&ensp;签</label>
										<div class="col-md-4 col-md-push-2">
											<input type="text"  class="form-control"  placeholder="昵称" id="title" name="title">
										</div>
										<div class="col-md-2 col-md-push-2">
												<input id="new-label" type="submit" class="btn btn-warning btn-block" value="新增">
										</div>
									</div>
								</form>	
							</div>
						</div>
						<div class="tab-pane" id="panel-2">
							<div id="label-modify" style="padding:2rem;">
								<div class="row clearfix">
									<div class="col-md-12 column">
										<table id="modify-label-table" class="table table-striped table-condensed">
											<thead>
												<tr>
													<th>
														标签名称
													</th>
													<th>
														已标记博客数目
													</th>
													<th>
														操作
													</th>
												</tr>
											</thead>
										</table>
									</div>
								</div>
							</div>
							<div class="text-center">
								<ul id="label-paginator"></ul> 
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<script src="js/jquery-3.0.0.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/multiple-select.js"></script>
	<script type="text/javascript" src="js/bootstrap-paginator.js"></script>
	<script src="js/jquery-confirm.min.js"></script>
	<script src="js/xcConfirm.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/back.js"></script>

	<script>
	$("a[name='randomGo']").click(function(){
			$.ajax({
				type:"GET",
				url:"userinfo_getUserIdRandomly",
				dataType:"json",
				success:function(data){
					if(data.userId==0){
						location.href=location.href;
					}else{
						location.href="others.html?userId="+data.userId;
					}
				}
			})
		})
	function init(){
	    	$.ajax({
	    		type:"GET",
	    		dataType:"json",
	    		url:"userinfo_getUserInfo",
	    		success:function(data){
	    			var userInfo=data.userInfo;
	    			$("img[name='head-image']").attr("src",userInfo.userImage);
	    		}
	    	})
	    }
	function getLabelTotalPages(){
				$.ajax({
					type:"GET",
					dataType:"json",
					url:'label_getLabelTotalPages',
					success:function(data){
						if(data.totalPages!=0)
						{
						var options = {
							currentPage: 1,
					        totalPages: data.totalPages,
					        numberOfPages:6,
					        bootstrapMajorVersion:3,
					        useBootstrapTooltip:true,
					        itemTexts:function(type,page, current){//文字翻译
					            switch (type) {
					                case "first":
					                    return "首页";
					                case "prev":
					                    return "上一页";
					                case "next":
					                    return "下一页";
					                case "last":
					                    return "尾页";
					                case "page":
					                    return page;
					            }
					        },
					        onPageClicked: function (event, originalEvent, type, page) {
		                        $.ajax({
		                        	type: "GET",
		                        	dataType:"json",  
		                            url:'label_getLabel?Page='+page, //点击分页提交当前页码
		                            success:function(data){
		                              $("#modify-label-table").empty();
	                                  var size = data.showSize;  
	                                  var list = data.labelList;
	                                  var num  = data.markNum;
		                              //DOM操作
		                              if (size != null){
		                              	var head=
		                              	'<thead><tr><th>标签名称</th><th>已标记博客数目'+
		                              	'</th><th>操作</th></tr></thead><tbody>';
		                              	$("#modify-label-table").append(head); 
		                              	for(var i=0;i<list.length;i++){
		                              		var html ='<tr>'+//
											'<td>'+//
	                                        '<span>'+list[i].labelTitle+'</span>'+//
	                                        '</td>'+//
	                                        '<td>'+num[i]+'</td>'+//
	                                        '<td>'+//
	                                        '<button type="button" class='+//
	                                        '"btn btn-warning btn-default delete-label" name="label-'+list[i].labelId+'">删除标签'+//
	                                        '</button>'+//
	                                        '<button type="button" class='+//
	                                        '"btn btn-warning btn-default modify-label" name="label-'+list[i].labelId+'">编辑标签'+//
	                                        '</button>'+//
	                                        '</td>'+//
	                                        '</tr>';//
	                                        $("#modify-label-table").append(html);  
		                              	}
		                              	var tail='</tbody>';
		                              	$("#modify-label-table").append(tail);
		                              	//删除label的JS 
		                              	$(".delete-label").click(function(){
		                              		var txt=  "是否确认删除标签:"+$(this).parent().prev().prev().children().eq(0).text();
		                              		var labelId =$(this).attr("name").split('-')[1];
											window.wxc.xcConfirm(txt, window.wxc.xcConfirm.typeEnum.warning,{
												onOk:function(){
													$.ajax({
														type:'GET',
														url:'label_deleteLabel?labelId='+labelId,
														success:function(){
															var txt=  "删除成功";
															window.wxc.xcConfirm(txt, window.wxc.xcConfirm.typeEnum.success);
															$("a[name='modify-label'][class='2']").click();
														}
													})
												}
											});
		                              	})
		                              	//编辑label的js
		                              	$(".modify-label").click(function(){
		                              		var labelId =$(this).attr("name").split('-')[1];
		                              		var txt=  "请输入新的标签名称";
											window.wxc.xcConfirm(txt, window.wxc.xcConfirm.typeEnum.input,{
												onOk:function(title){
													$.ajax({
														type:"GET",
														url:"label_updateLabel?labelId="+labelId+"&labelTitle="+title,
														success:function(){
															var txt=  "更改成功";
															window.wxc.xcConfirm(txt, window.wxc.xcConfirm.typeEnum.success);
															$("a[name='modify-label'][class='2']").click();
														}

													})
												}
											});
		                              	})
		                              }
	                                  else{  
	                                        $("#modify-label-table").append('没有找到相应数据');
	                                    } 
		                            }
		                        })
						}
					}
					$('#label-paginator').bootstrapPaginator(options);
					$($('#label-paginator').children().get(0)).children().click();
					//模拟一次点击事件	
						}
						

				}
		    })
		}
    $(function() {
    	init();
        $('.ms').multipleSelect({
            width: '50%'
        });
        $("a[name='modify-label']").click(getLabelTotalPages);
        $("#new-label").click(function(){
        	var flag=0;
			$.ajax({
				type:'GET',
				url:'label_createLabel?title='+$("#title").val(),
				async:false,
				success:function(){
					//刷新界面？pass
					var txt=  "添加成功";
					window.wxc.xcConfirm(txt, window.wxc.xcConfirm.typeEnum.success);
					$("#title").val('');
				}		
			})
        })
    });
	</script>
</body>
</html>